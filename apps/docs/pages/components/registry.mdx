---
title: "Registry"
weight: 1
---

# ENS Org Registry

The central registry contract that manages organizational ENS domains and their associated resolvers, governance controls, and access permissions.

## Core Functions

The ENS Org Registry serves as the authoritative source for:
- Organizational domain registration and management
- Custom resolver deployment and assignment
- Governance-controlled updates and permissions
- Integration with existing ENS infrastructure

## Contract Interface

```solidity
interface IENSOrgRegistry {
    // Organization registration
    function registerOrganization(
        bytes32 node,
        OrgProfile calldata profile,
        GovernanceConfig calldata governance
    ) external;
    
    // Resolver management
    function setCustomResolver(bytes32 node, address resolver) external;
    function getResolver(bytes32 node) external view returns (address);
    
    // Governance controls
    function updateGovernanceConfig(
        bytes32 node, 
        GovernanceConfig calldata config
    ) external;
    
    // Access control
    function grantRole(bytes32 role, address account) external;
    function hasRole(bytes32 role, address account) external view returns (bool);
}
```

## Data Structures

### Organization Profile
```solidity
struct OrgProfile {
    string alias;           // Display name
    string description;     // Organization description  
    string avatar;          // ENSIP-12 avatar (IPFS/NFT)
    string website;         // Primary website URL
    string email;           // Contact email
    string[] socialLinks;   // Social media profiles
    mapping(uint256 => bytes) addresses; // Multi-chain addresses
}
```

### Governance Configuration
```solidity
struct GovernanceConfig {
    address votingContract;     // DAO governance contract
    uint256 proposalThreshold;  // Minimum tokens to propose
    uint256 votingDelay;        // Delay before voting starts
    uint256 votingPeriod;       // Voting duration
    bytes32[] allowedRoles;     // Roles that can update metadata
}
```

## Registration Process

### Step 1: Domain Ownership Verification
```solidity
// Verify caller owns the ENS domain
require(ens.owner(node) == msg.sender, "Not domain owner");
```

### Step 2: Profile Validation
```solidity
// Validate required fields
require(bytes(profile.alias).length > 0, "Alias required");
require(bytes(profile.description).length > 0, "Description required");
```

### Step 3: Resolver Deployment
```solidity
// Deploy custom resolver for the organization
address customResolver = deployOrgResolver(node, profile, governance);
ens.setResolver(node, customResolver);
```

### Step 4: Initial Configuration
```solidity
// Set initial metadata and permissions
IOrgResolver(customResolver).setTextRecords(node, textRecords);
IOrgResolver(customResolver).setAddresses(node, addresses);
_grantRole(ORG_ADMIN_ROLE, governance.votingContract);
```

## Governance Integration

### Role-Based Access Control
```solidity
bytes32 public constant ORG_ADMIN_ROLE = keccak256("ORG_ADMIN");
bytes32 public constant METADATA_UPDATER_ROLE = keccak256("METADATA_UPDATER");
bytes32 public constant SUBDOMAIN_MANAGER_ROLE = keccak256("SUBDOMAIN_MANAGER");
```

### Governance-Controlled Updates
```solidity
function updateMetadata(
    bytes32 node,
    string[] calldata keys,
    string[] calldata values
) external {
    require(hasRole(METADATA_UPDATER_ROLE, msg.sender), "Not authorized");
    
    // Verify governance approval
    require(isApprovedByGovernance(node, msg.data), "Not approved");
    
    IOrgResolver resolver = IOrgResolver(getResolver(node));
    resolver.setTextRecords(node, keys, values);
}
```

## Multi-chain Address Management

### Setting Addresses
```solidity
function setMultiChainAddresses(
    bytes32 node,
    uint256[] calldata coinTypes,
    bytes[] calldata addresses
) external onlyRole(ORG_ADMIN_ROLE) {
    IOrgResolver resolver = IOrgResolver(getResolver(node));
    
    for (uint i = 0; i < coinTypes.length; i++) {
        resolver.setAddr(node, coinTypes[i], addresses[i]);
    }
    
    emit MultiChainAddressesUpdated(node, coinTypes, addresses);
}
```

### Supported Coin Types
| Chain | Coin Type | Example Address |
|-------|-----------|-----------------|
| Ethereum | 60 | `0x1234...` |
| Polygon | 137 | `0x5678...` |
| Arbitrum | 42161 | `0x9abc...` |
| Optimism | 10 | `0xdef0...` |

## Events

```solidity
event OrganizationRegistered(
    bytes32 indexed node,
    address indexed owner,
    address resolver
);

event MetadataUpdated(
    bytes32 indexed node,
    string[] keys,
    string[] values
);

event MultiChainAddressesUpdated(
    bytes32 indexed node,
    uint256[] coinTypes,
    bytes[] addresses
);

event SubdomainDelegated(
    bytes32 indexed parent,
    bytes32 indexed subdomain,
    address indexed manager
);
```

## Security Considerations

### Access Control
- Only domain owners can register organizations
- Governance contracts control metadata updates
- Role-based permissions for different operations
- Time-delayed execution for critical changes

### Data Validation
- Required fields enforced during registration
- Address format validation for multi-chain support
- ENSIP compliance checks for metadata fields
- Governance signature verification

### Upgrade Safety
- Critical functions are non-upgradeable
- Resolver contracts can be replaced via governance
- Emergency pause functionality for extreme cases
- Comprehensive event logging for transparency

## Integration Examples

### JavaScript/TypeScript
```typescript
import { ENSOrgRegistryClient } from '@ens-org-registry/client'

const registry = new ENSOrgRegistryClient({ provider, network: 'mainnet' })

// Register organization
await registry.registerOrganization({
  name: 'myorg.eth',
  profile: {
    alias: 'My Organization',
    description: 'A decentralized organization',
    avatar: 'ipfs://QmHash...',
    website: 'https://myorg.com'
  },
  governance: {
    votingContract: '0x1234...',
    proposalThreshold: '1000000000000000000'
  }
})
```

### Smart Contract Integration
```solidity
import {IENSOrgRegistry} from "./interfaces/IENSOrgRegistry.sol";

contract MyDAOIntegration {
    IENSOrgRegistry public registry;
    
    function updateOrgMetadata(
        bytes32 node,
        string[] calldata keys,
        string[] calldata values
    ) external {
        // Verify this is called through governance
        require(msg.sender == governanceContract, "Only governance");
        
        registry.updateMetadata(node, keys, values);
    }
}
```

## Deployment Configuration

### Constructor Parameters
```solidity
constructor(
    address _ensRegistry,
    address _defaultResolver,
    address _owner
) {
    ensRegistry = ENSRegistry(_ensRegistry);
    defaultResolver = _defaultResolver;
    _grantRole(DEFAULT_ADMIN_ROLE, _owner);
}
```

### Network Addresses
| Network | Registry Address | Block |
|---------|------------------|-------|
| Mainnet | `0x1234...` | TBD |
| Sepolia | `0x5678...` | TBD |
| Polygon | `0x9abc...` | TBD |